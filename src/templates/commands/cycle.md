---
description: TDD 사이클 관리 (red/green/refactor/commit)
---

# /cycle - TDD 사이클

TDD 사이클을 단계별로 진행합니다.

## 사용법

- `/cycle red` - 실패 테스트 작성 단계
- `/cycle green` - 최소 구현 단계
- `/cycle refactor` - 리팩토링 단계
- `/cycle commit` - 커밋 단계
- `/cycle status` - 현재 사이클 상태

## 사이클 순서

```
red → green → refactor → commit → (다음 red)
```

**순서를 반드시 지켜야 합니다.**

---

## /cycle red

### 목적
실패하는 테스트 **1개만** 작성합니다.

### 체크리스트
- [ ] 테스트는 1개만 작성했는가?
- [ ] 테스트가 실패하는 것을 확인했는가?
- [ ] 테스트 이름이 의도를 명확히 설명하는가?

### 수행 작업
1. 사용자와 함께 테스트 작성
2. 테스트 실행하여 실패 확인
3. `.vibe-anchor/cycles/current.md` 업데이트:

```markdown
## 현재 상태

**🔴 Red** - 실패 테스트 작성됨

## 사이클 정보

- 태스크: T{id}
- 단계: red
- 시작: {시간}
- 테스트: {테스트 파일:함수명}
```

### 주의사항
- 구현 코드 작성 금지
- 여러 테스트 작성 금지

---

## /cycle green

### 전제조건
- red 단계가 완료되어야 함

### 목적
테스트를 통과하는 **가장 간단한** 코드를 작성합니다.

### 체크리스트
- [ ] 테스트가 통과하는가?
- [ ] 가장 단순한 구현인가?
- [ ] 리팩토링은 하지 않았는가?
- [ ] 새 폴더 생성 시 진입점에 명세 링크 주석을 추가했는가?

### 수행 작업
1. 최소한의 구현 코드 작성
2. **새 폴더 생성 시**: 진입점 파일(index.ts)에 명세 링크 주석 추가
3. 테스트 실행하여 통과 확인
4. `cycles/current.md` 업데이트:

### 새 폴더 생성 시 명세 링크 추가

**plan.md에 계획된 대로** 폴더 진입점에 주석을 추가합니다:

```typescript
// src/auth/index.ts

/**
 * 📋 설계: specs/001-login/plan.md
 *
 * 인증 관련 모듈
 * - useAuth: 인증 상태 관리 훅
 * - authService: 로그인/로그아웃 API 호출
 */

export * from './useAuth';
export * from './authService';
```

**이유**: 하위 폴더 CLAUDE.md는 자동 로드되지 않으므로, 코드 주석으로 명세 연결

```markdown
## 현재 상태

**🟢 Green** - 테스트 통과

## 사이클 정보
- 단계: green
- 구현 파일: {파일명}
```

### "일단 동작하게" 원칙
- 하드코딩 OK
- 중복 OK
- 깔끔하지 않아도 OK
- **테스트만 통과하면 됨**

---

## /cycle refactor

### 전제조건
- green 단계가 완료되어야 함

### 목적
코드를 정리합니다. **동작은 변경하지 않습니다.**

### 체크리스트
- [ ] 테스트가 계속 통과하는가?
- [ ] 동작을 변경하지 않았는가?
- [ ] 중복을 제거했는가?
- [ ] 의도가 명확해졌는가?

### 수행 작업
1. 코드 정리 (중복 제거, 네이밍 개선 등)
2. 매 변경마다 테스트 실행
3. `cycles/current.md` 업데이트:

```markdown
## 현재 상태

**🔵 Refactor** - 코드 정리 중

## 리팩토링 내역
- {변경 1}
- {변경 2}
```

### 금지 사항
- 새 기능 추가 금지
- 테스트 변경 금지
- 동작 변경 금지

---

## /cycle commit

### 전제조건
- refactor 단계가 완료되어야 함 (또는 skip)

### 목적
현재 사이클을 커밋합니다.

### 커밋 메시지 형식

```
[{phase}] {설명}

- 테스트: {테스트 설명}
- 구현: {구현 설명}
```

예시:
```
[green] 로그인 폼 이메일 유효성 검사 구현

- 테스트: 유효하지 않은 이메일 형식 거부
- 구현: regex 패턴으로 이메일 검증
```

### 수행 작업
1. git add 관련 파일
2. git commit
3. `cycles/current.md` 초기화
4. `cycles/current.md`의 히스토리에 추가
5. `CLAUDE.md`의 "현재 작업" 상태를 "대기"로 변경

### 사이클 히스토리 업데이트

```markdown
## 사이클 히스토리

| 시작 | 태스크 | red | green | refactor | commit |
|------|--------|-----|-------|----------|--------|
| 14:30 | T001 | ✅ | ✅ | ✅ | abc1234 |
```

---

## 시행착오 기록

### 순환 오류 방지

사이클 진행 중 이전에 실패한 접근법이 감지되면 경고:

```
⚠️ 이전 시행착오 발견!

의도 001에서 이전에 시도한 접근법:
- flex 레이아웃 → 깨짐 (실패)
- absolute 위치 → 반응형 실패

이 접근법을 다시 시도하시겠습니까?
```

### 새 시행착오 기록

실패한 접근법은 관련 의도 파일에 기록:

1. `.vibe-anchor/intents/{id}.md`의 "시행착오" 섹션 업데이트
2. "절대 하지 말 것" 섹션에 추가 (필요시)

## 완료 조건

- [ ] 모든 단계 완료
- [ ] 커밋 완료
- [ ] 히스토리 업데이트
- [ ] 시행착오 기록 (해당시)
